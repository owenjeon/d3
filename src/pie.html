<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script src="/static/d3.v4.min.js"></script>
  <title>Pie Chart</title>
</head>
<body>
<div class="chart"></div>
<script>
  const bxSize = {w:500, h:500}
  const margin = { top: 30, right: 30, bottom: 30, left: 30 };
  const [width, height] = [bxSize.w - margin.left - margin.right, bxSize.h - margin.top - margin.bottom];
  const svg = d3.select('.chart')
    .append('svg')
    .attr('width', bxSize.w).attr('height', bxSize.h)
    .append('g')
    .attr('transform', `translate(${margin.left} ${margin.top})`);
  svg.append('rect').attr('width', width).attr('height', height).attr('fill', '#f5f5f5');

  function getData() {
    return new Promise(function (resp) {
      d3.json('/Code/tweets.json', function (res) {
        resp(res)
      })
    })
  }

  async function drawPieChart(){
    const data = await getData();
    const nestedData = d3.nest().key(el=>el.user).entries(data.tweets);

    nestedData.forEach(el=>{
      el.numTweets = el.values.length;
      console.log(el.numTweets);
    })

    const pieChart = d3.pie().value(d=>d.numTweets);
    const myPie = pieChart(nestedData);
    const newArc = d3.arc().outerRadius(80).innerRadius(30);
    const labelArc = d3.arc().outerRadius(60).innerRadius(60);

    const g = svg.append('g').attr('transform', `translate(${width/2}, ${height/2})`);
    g.selectAll('path')
      .data(myPie)
      .enter()
      .append('path')
      .attr('d', newArc)
      .style('fill', 'blue')
      .style('stroke', 'black')
      .style('stroke-width', 2);

    g.selectAll("text")
      .data(myPie)
      .enter()
      .append('text')
      .attr("transform", function(d) { return "translate(" + labelArc.centroid(d) + ")"; })
      .attr("dy", ".35em")
      .text(function(d) { return d.data.key; });
  }








  drawPieChart();
</script>
</body>
</html>